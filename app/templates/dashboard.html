<!DOCTYPE html>
<html>
  <head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/css/materialize.min.css">
    <!--Let browser know website is optimized for mobile-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-beta/js/materialize.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
      .hidden{
        display: none;
      }
    </style>
  </head>
  <body>
    <div class='container'>
      <div class='row'>
        <div class='col s6'>
          <div class='card'>
            <div class='card-content'>
              <div class='card-title'>Beats</div>
              <label for="app-id-input">Id to track</label>
              <input id='app-id-input' type='text'/>
            </div>
          </div>
        </div>
        <div class='col s6'>
          <div id='widget-area' class='row'>
            {% for monitor in monitors %}
              <div id='widget-{{monitor["id"]}}' class='col s4 widget' data-url='/app/{{monitor["id"]}}'>
                <div class='card'>
                  <div class='card-content'>
                    <i class='material-icons' style='color:green;'>mood</i>
                    <div class='health'>100</div>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </body>
  <script>

  function loop(){
    var widgets = document.getElementsByClassName('widget')
    for(var i = 0; i < widgets.length; i++){
      var url = widgets[i].dataset['url']
      $.get(url, function( data ){
        id = '#widget-'+data.id
        health = data.status.health

        $(id).find('.health').html(health)
        $(id).find('i').css('color', setColor(health))
      })
    }
    window.setTimeout(function(){
      window.requestAnimationFrame(loop);
    },1000)
  }
  loop();

  function setColor(health){
    if(health < 80){
      return 'red'
    }else if(health < 90){
      return 'orange'
    }else {
      return 'green'
    }

  }







  </script>
</html>
